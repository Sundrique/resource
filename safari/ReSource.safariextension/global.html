<!DOCTYPE html>
<html>
<head>
    <title></title>
    <script type="text/javascript">
        var config = [
            {
                source: 'source.js',
                reSource: 'reSource.js'
            },
            {
                source: 'source.css',
                reSource: 'reSource.css'
            }
        ];

        var count = 0;

        function getReSource(event) {
            var source = event.message;

            for (var i = 0; i < config.length; i++) {
                var regexp = new RegExp(config[i].source);
                if (regexp.test(source)) {
                    event.message = config[i].reSource;
                    updateCounter();
                    break;
                }
            }
        }

        function updateCounter() {
            safari.extension.toolbarItems[0].badge = ++count;
        }

        safari.application.addEventListener("message", getReSource, true);
    </script>
</head>
<body>

</body>
</html>